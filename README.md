
컴퓨터공학부
졸업설계Ⅱ 보고서

- IoT와 융합한 응급안전알림서비스 -

팀 이 름 :  EST5507
팀    원 :  한현희
지도교수 :  주영복
제 출 일 :  2019.09.24


목  차

I. 서 론	 3
1. 작품선정 배경 및 필요성	 3
2. 연구 목표	 4
3. 역할 분담 및 팀 소개	 6
4. 연구 일정	 6

II. 본 론	 7
1. 연구 내용	 7
2. 문제점 및 해결방안	 10

III. 결론	 11
1. 연구 결과	 11
2. 작품제작 소요재료 목록	 14

참고자료	 14


I. 서 론

1. 작품선정 배경 및 필요성
뉴스나 신문을 보면 흔히 휴대전화 통신이 불가능한 지역에서 조난 등 응급 상황이 발생했다는 기사를 접할 수 있다. 한 예로, 산악지역의 조난 사례가 있다. 이 사건 역시 휴대전화 통신이 불안정해서 문제가 발생 된 것으로 파악되었다.


<출처 : http://www.newspim.com/news/view/20190527000184>
흔히 접할 수 있는 조난 등의 응급 상황의 예이다. 그렇다면 산악지역 등의 휴대전화 통신이 불가능한 지역에 휴대전화 통신 기지국 수를 늘리면 해결되는 문제가 아닐까. 이와 관련한 자료를 조사해봤다. ‘왜 이동 3사에서 통신 기지국을 증가시키지 못하는가’에 대한 기사이다.

[출처 : http://www.kyongbuk.co.kr/news/articleView.html?idxno=2010273]
소방서에서 통화 불능지역 해소를 위해 요청했지만, 중계기 설치 등 비용적인 부분에서 진행하지 못하고 있다. 그렇다고 사고가 계속 발생하고 있는데 방관만 하고 있을 수는 없다고 생각해서 LoRa망을 이용하여 비교적 저렴하고, 광범위하게 통신을 해서 조난 등의 응급 상황을 대처할 수 있는 시스템을 고안해보았다.
LoRa망의 가장 큰 특징으로는 10~15km에 달하는 넓은 통신 범위와 적은 전력 소모가 있다. 통신 범위가 넓어 비용도 비교적 저렴하고, 전력 소모가 크지 않아 배터리 등의 문제도 큰 문제 없이 해결할 수 있는 장점이 있다.
결론적으로, 산악지역 등의 휴대전화가 불가능한 지역에 LoRa망을 설치하여, 모듈을 통해 구조대나 관리소에 자신의 응급 상황을 알리고 사고를 빠르게 대처할 수 있는 시스템 구성을 고안하였다.

2. 연구 목표
가. 연구목적
1) 최신 IoT 통신 기술인 SKT LoRa 상용망에 대해 학습하기 위함이다.
2) 산악지역 등 휴대전화가 불가능한 지역에서 발생되는 조난 등의 응급 상황에 신속하게 대처할 수 있는 시스템을 구성하기 위함이다.
3) IoT 서비스 플랫폼인 MQTT Cloud를 이용하여 디바이스와 서버 간 통신을 구현하기 위함이다.
4) 서로 다른 통신 방식을 가진 디바이스와 웹/앱 간의 상호 통신을 구현하기 위함이다.

본 작품은 최신 IoT 통신 방법인 SKT LoRa Wan 기술을 이용하여 MQTT Cloud를 통해 디바이스와 웹서버와 애플리케이션이 상호 통신하는 하나의 시스템을 구축하는데 의의가 있다. 이 작품을 구현하기 위해 MQTT 등 웹서버와 관련된 지식, 사물 통신에 대한 데이터베이스 구축 및 라즈베리파이와 아두이노 연동, Plm100 모듈의 LoRa Wan 통신 프로토콜에 대한 전반적인 이해가 필요하며, 아두이노와 통신 모듈 간 제어기술과 전송 방법에 대해서도 숙지해야 한다.

나. 수행과정 및 방법
· 주기적으로 연구실에서 팀원들과의 회의
· 주 단위로 세부적인 계획을 세워 일정에 따른 프로젝트 진행
· 주 1회 진행 상황 공유 및 연동

LoRa 모듈과 MQTT Cloud, Arduino간 통신할 수 있는 환경을 구성한다.
LoRa 모듈에서 센서들의 데이터를 IoT 서비스 플랫폼을 통해 웹서버로 전송 또는 수신할 수 있는 기능을 구현한다.
 스마트폰이 IoT 서비스 플랫폼을 통해 아두이노를 제어하도록 구현한다.

다. 연구 결과물 형태
연구 결과물의 형태는 아두이노와 라즈베리파이, MQTT CLOUD, 스마트폰 애플리케이션 4가지 형태가 하나의 시스템으로 이루어져 있다.


4. 연구 일정

                   일정
  연구내용
3월 이전
3월
4월
5월
6월
7월
8월
9월
문제 정의 및 아이디어 구체화


필요 기술 정리 및 기초 학습



온도 센서 제작 및 LoRa망 연구



GPS 센서 제작



프로토타입(모듈) 제작



통신 테스트


서버 및 DB구축

애플리케이션 구현


유지보수 및 완성






II. 본 론

1. 연구 내용
가. 선행연구 및 제품 관련 자료조사․분석
1) 제품 관련 자료조사
- LoRa   LoRa는 2015년에 IBM, Semtechm, Actility 등을 주축으로 LoRa 얼라이언스에서 발표한 LoRaWan 개방형 표준이다. 가장 큰 특징으로는 10 ~ 15km에 달하는 넓은 통신범위와 적은 전력소모가 있다. 따라서 주로 배터리를 이용해야하는 일이 잦은 사물인터넷에서는 큰 경쟁력을 갖는다. 또한, 기기간 동기화가 필요없고 Noise에 강하다는 장점을 갖는다. 현재 SKT에서 통신 서비스를 제공 중이며 비면허 대역 주파수를 사용하기 때문에 망 사용에 적은 비용이 소요된다는 것도 큰 경쟁력 중 하나이다. 본 연구에서는 넓은 통신범위와 저전력이라는 특징을 모듈과 결합하여 착용자의 안전을 제공하기 위한 방법으로 사용할 계획이다. 본 시스템에서 추출되는 위치 정보, 응급 상태 등의 데이터를 SKT에서 서비스 중인 LoRa 상용망을 이용해 전송하는 시스템을 구현하고자 한다. 이를 위해 LoRa 모듈에 대한 제어기법, Server에서의 모듈 제어, LoRa Wan 프로토콜에 대한 연구가 필요하다. 


- MQTT Cloud   본 연구에서는 LoRa를 이용한 IoT 서비스 개발을 위해 MQTT Cloud를 사용할 계획이다. 이 디바이스에서 App/Webserver까지 데이터를 전송하기 위해서는 다음과 같은 과정을 거친다. 디바이스에 연결된 센서로부터 읽어 들인 정보를 LoRa 모듈을 통해 라즈베리파이로 전송한다. 이후 웹 서버와 MQTT Cloud를 통해 통신이 이루어진다. MQTT란 발행/구독 방식의 메시지 큐 방식을 의미한다. 크게 Broker, Publisher, Subscriber로 이루어진다. 토픽을 설정하여 원하는 메시지만을 구독할 수 있다는 것이 큰 특징이다. 따라서 사물 인터넷과 같이 대역폭이 제한된 통신환경에 최적화되어있다. MQTT Cloud란 Broker와 서버의 역할을 해주는 Cloud 서비스를 말한다. 네트워크 상에 Broker를 동작시키도록 함으로써 나의 위치와 상관없이 메시지를 구독/발행할 수 있다. 따라서 이러한 특성을 이용하여 웹서버와 라즈베리파이는 데이터를 송ㆍ수신, 통신 과정에 대한 모니터링, 제어를 할 수 있도록 한다.
    
[  MQTT Cloud를 이용한 통신 과정 개요 ] 

- Android
애플리케이션은 Android 운영체제를 이용할 계획이다. Android는 Java를 기반으로 한 모바일 운영체제이며 외부의 API를 쉽게 이용할 수 있다는 특징이 있다. 본 시스템에서 구현할 어플리케이션의 기능으로는 사용자의 위치를 추적하고 보여주기 위해 지도 API를 활용할 계획이다. Google Maps 등 마커와 Tracking 기능을 구현하는데 용이한 API를 참고할 예정이다.

- GPS Sensor
GPS 수신기는 세 개 이상의 GPS 위성으로부터 송신된 신호를 수신하여 위성과 수신기의 위치를 결정한다. 위성에서 송신된 신호와 수신기에서 수신된 신호의 시간차를 측정하면 위성과 수신기 사이의 거리를 구할 수 있는데, 이때 송신된 신호에는 위성의 위치에 대한 정보가 들어 있다. 최소한 세 개의 위성과의 거리와 각 위성의 위치를 알게 되면 삼변측량에서와 같은 방법을 이용해 수신기의 위치를 계산할 수 있다. 그러나 시계가 완전히 정확하지 않기 때문에 오차를 보정하고자 보통 네 개 이상의 위성을 이용해 위치를 결정한다.










2) 선행 연구
      가. 작품소개 
        <지그비 통신을 이용한 자동 조난신고 시스템 / 특허번호 : KR20110017746A>
저렴한 비용으로 생산 가능한 지그비 통신 방식의 조난신호 발생장치와 지그비 통신 장치를 이용하여 위험에 처한 상황에서 누구나 쉽게 조난신호를 발생할 수 있고 구조될 수 있도록 한 지그비 통신을 이용한 자동 조난신고 시스템에 관한 것이다. 

나. 작품 특징
1) 조난 상황을 알리기 위한 조난 스위치부에서 무선 통신장치로 전송한다.
2) 조난신호 발생 장치에서 신호를 확인한다.
3) 이 신호를 조난센터에 전송하는 조난 서버로 전송한다.

다. 기대효과
   1) 가격이 저렴한 구난 신호 발생 장치의 공급이 가능하므로 누구나 이용할 수 있다.
   2) 지그비 통신 방식을 이용하므로 어느 곳에나 설치가 용이하게 시스템 관리가 수월하고 설치비용이 저렴하여 저전력으로 시스템을 운용할 수 있다.
   3) 지그비 통신 방식의 무선통신장치의 위치 정보를 알 수 있어 조난자에 대한 빠른 구난이 가능하다.


2. 문제점 및 해결방안
가. 문제 인식
아두이노 모듈을 갖고 실내, 동굴 등의 GPS가 잡히지 않는 지역으로 들어가면 위치가 보이지 않아 구조에 어려움이 있다.

나. 문제 정의
GPS가 잡히지 않는 지역에 들어가면 위치를 추적하기 힘들어 대안이 필요하다.

다. 현실적 제한 조건
GPS의 특징상 외부에 있지 않으면 위치 측정에 어려움이 있다.

라. 해결방안
사용자가 가는 길을 Tracking하여 마지막에 측정된 위치 근처를 유추하여 구조에 도움을 준다.



III. 결론
1. 연구 결과


작 품 명
IoT와 융합한 응급안전알림서비스
가. 시스템 구성도

4가지 부분으로 구성되어 있다. 아두이노 모듈과 라즈베리파이, MQTT CLOUD, APP이다.
사용자가 가지고 다닐 아두이노 모듈의 경우, GPS센서, LoRa 모듈, 온도 센서, 블루투스 모듈을 포함하고 있다. 데이터를 LoRa 통신을 통해 라즈베리파이로 전송하는 기능을 한다.
사무실 등의 인터넷이 가능한 곳에서 사용될 라즈베리파이는 아두이노 모듈에서 전송한 데이터의 값을 MQTT서버로 전송하는 역할을 한다. 전송될 데이터를 종합하고 제어하는 기능을 한다.
MQTT CLOUD는 라즈베리파이에서 보낸 데이터를 관리자의 APP으로 전송하는 역할을 한다. 각 기기 간의 중추 서버 기능을 한다.
APP은 관리자가 사용자의 응급 상황을 파악하여 구조할 수 있게 해준다. 사용자의 현재 온도, GPS좌표를 통한 지도 트래킹, 메시지를 표시한다.

![noname01](https://user-images.githubusercontent.com/50434736/83107851-e7886d00-a0f9-11ea-9734-c4f2d062c7d8.jpg)
![noname02](https://user-images.githubusercontent.com/50434736/83107861-ece5b780-a0f9-11ea-9b6b-0d94035969e7.jpg)
![noname04](https://user-images.githubusercontent.com/50434736/83107903-f96a1000-a0f9-11ea-9da0-a75f1b94c579.jpg)
![noname03](https://user-images.githubusercontent.com/50434736/83107904-fa9b3d00-a0f9-11ea-9d00-05aeac24c4a4.jpg)



나. 아두이노 모듈
   
- 온도 센서 : 현재 기온을 측정하여 사용자에게 전달해주기 위한 센서
- GPS 모듈 : 사용자의 현재 위치를 알려주기 위한 모듈 
- LoRa 통신모듈 : 웹 서버와 통신하기 위한 장거리, 저전력 통신 모듈 
- Arduino Mega: 연결된 센서와 통신 모듈의 데이터를 처리하기 위한 프로세서 
- 블루투스 : 관리자에게 응급 상황을 전송하기 위한 통신 모듈


다. 라즈베리 파이

     - LoRa 통신모듈 : 웹 서버와 통신하기 위한 장거리, 저전력 통신 모듈
     - 센서 데이터, 블루투스 통신, LoRa 통신을 제어하는 제어부


라. MQTT CLOUD


라즈베리파이에서 전송한 데이터를 MQTT CLOUD가 받아서 알맞은 값으로 변환한 후, APP으로 전달해주는 역할을 한다.


마. APP

- 현재 온도 값 출력 기능
- 착용자의 위치 트래킹 기능
- 위험 상황 발생시 블루투스를 통한 메시지 전송 기능
- 블루투스 메시지 확인 기능  

2. 작품제작 소요재료 목록

번호
품목
제품명
수량
1
LoRa 통신 모듈
PL-EVK1
1EA
2
LoRa 통신 모듈
PLM100
2EA
3
마이크로프로세서 
Arduino Mega 2560
1EA
4
마이크로프로세서
Raspberry Pi 3
1EA
5
블루투스 모듈
HM-10
1EA
6
GPS모듈
NEO-6M GPS 
1EA
7
온도 센서
18B20
1EA
8
배터리
9V
1EA




참고자료

[1] 서민우, 아두이노처럼 사용하는 라즈베리 파이3 직접 코딩하기(WiringPi 라이브러리를 이용하여 아두이노 코딩처럼 배우는 라즈베리 파이 코딩북), 앤써북, 2018.
[2] 서민우, 한 권으로 끝내는 아두이노 입문+실전(종합편), 앤써북, 2019.
[3] 정재곤, 안드로이드 앱 프로그래밍, 이지스퍼블리싱, 2014.
[5] 황재호, PHP 프로그래밍 입문, 한빛미디어, 2013.
[6] LoRa 기술, http://leaders.asiae.co.kr/news/articleView.html?idxno=66141
[7] GPS, https://ko.wikipedia.org/wiki/GPS
[8] MQTT CLOUD, https://www.cloudmqtt.com
[8] 지그비 통신을 이용한 자동 조난신고 시스템, 
    0https://patents.google.com/patent/KR20110017746A/ko
[9] 조난 기사 자료, https://www.http://www.newspim.com/news/view/20190527000184
[10] 휴대전화 불능지역 기사 자료, http://www.kyongbuk.co.kr/news/articleView.html?idxno=2010273



